<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hongos vs Zombies 2</title>
    <style>
      body {
        font-family: "Comic Sans MS", cursive, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #87ceeb; /* Cielo azul */
        color: #333;
        background-image: url("/clouds.png");
        background-repeat: repeat-x;
        background-position: top;
        overflow-x: hidden;
      }

      /* Estilos para la pantalla de inicio */
      #pantalla-inicio {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url("/fondo-inicio.png");
        background-size: cover;
        background-position: center;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        transition: opacity 1s ease-in-out;
      }

      .titulo-inicio {
        font-size: 60px;
        color: #4a8f29;
        text-shadow: 3px 3px 0 #000, -3px 3px 0 #000, -3px -3px 0 #000,
          3px -3px 0 #000;
        margin-bottom: 40px;
        text-align: center;
        animation: pulsar 2s infinite;
        transform-origin: center;
      }

      @keyframes pulsar {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      .boton-jugar {
        background-color: #4a8f29;
        color: white;
        font-size: 30px;
        padding: 15px 60px;
        border-radius: 50px;
        border: 4px solid #8b4513;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 8px 0 #2d5718, 0 15px 20px rgba(0, 0, 0, 0.35);
        position: relative;
        text-transform: uppercase;
        font-weight: bold;
        letter-spacing: 2px;
        margin-bottom: 30px;
      }

      .boton-jugar:hover {
        transform: translateY(-5px);
        box-shadow: 0 13px 0 #2d5718, 0 20px 25px rgba(0, 0, 0, 0.35);
      }

      .boton-jugar:active {
        transform: translateY(5px);
        box-shadow: 0 3px 0 #2d5718, 0 5px 10px rgba(0, 0, 0, 0.35);
      }

      .botones-adicionales {
        display: flex;
        gap: 20px;
        margin-top: 20px;
      }

      .boton-secundario {
        background-color: #8b4513;
        color: white;
        font-size: 18px;
        padding: 10px 20px;
        border-radius: 30px;
        border: 2px solid #6c5353;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 0 #5d2e0d, 0 8px 10px rgba(0, 0, 0, 0.25);
      }

      .boton-secundario:hover {
        transform: translateY(-3px);
        box-shadow: 0 7px 0 #5d2e0d, 0 12px 15px rgba(0, 0, 0, 0.25);
      }

      .personajes-inicio {
        position: absolute;
        bottom: 0;
        width: 100%;
        display: flex;
        justify-content: space-between;
        padding: 0 50px;
        box-sizing: border-box;
      }

      .hongo-inicio {
        font-size: 80px;
        animation: rebote 3s infinite;
        transform-origin: bottom center;
      }

      .zombie-inicio {
        font-size: 80px;
        animation: tambaleo 4s infinite;
        transform-origin: bottom center;
      }

      @keyframes rebote {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-20px);
        }
      }

      @keyframes tambaleo {
        0%,
        100% {
          transform: rotate(0deg);
        }
        25% {
          transform: rotate(5deg);
        }
        75% {
          transform: rotate(-5deg);
        }
      }

      /* Estilos para el juego */
      #pantalla-juego {
        display: none;
        padding: 0;
        transition: opacity 1s ease-in-out;
        min-height: 100vh;
        max-width: 100vw;
        overflow-x: hidden;
      }

      .barra-superior {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background-color: rgba(139, 69, 19, 0.9);
        padding: 5px 10px; /* Reducido el padding */
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        box-sizing: border-box;
        height: 50px; /* Altura fija reducida */
      }

      .sol-contador {
        background-color: #333;
        color: #ffd700;
        padding: 5px 10px; /* Reducido el padding */
        border-radius: 20px;
        font-weight: bold;
        display: flex;
        align-items: center;
        border: 2px solid #ffd700;
        font-size: 14px; /* Tama√±o de fuente reducido */
      }

      .sol-contador::before {
        content: "‚òÄÔ∏è";
        margin-right: 5px;
        font-size: 18px; /* Tama√±o reducido */
      }

      .oleada-contador {
        background-color: #333;
        color: #ff6b6b;
        padding: 5px 10px; /* Reducido el padding */
        border-radius: 20px;
        font-weight: bold;
        display: flex;
        align-items: center;
        border: 2px solid #ff6b6b;
        font-size: 14px; /* Tama√±o de fuente reducido */
      }

      .oleada-contador::before {
        content: "üßü";
        margin-right: 5px;
        font-size: 18px; /* Tama√±o reducido */
      }

      .plantas-seleccion {
        position: fixed;
        top: 60px; /* Espacio entre barras */
        left: 0;
        width: 100%;
        display: flex;
        justify-content: flex-start;
        gap: 5px; /* Reducido el gap */
        background-color: rgba(139, 69, 19, 0.9);
        padding: 5px; /* Reducido el padding */
        overflow-x: auto;
        z-index: 900;
        box-sizing: border-box;
        height: 100px; /* Altura aumentada */
      }

      .planta-card {
        width: 65px; /* Aumentado el ancho */
        height: 85px; /* Aumentado el alto */
        background-color: #6c5353;
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        font-size: 11px; /* Tama√±o de fuente ajustado */
        border-radius: 8px;
        border: 2px solid #4a4a4a;
        padding: 3px; /* Reducido el padding */
        transition: all 0.2s;
        cursor: pointer;
        position: relative;
        flex-shrink: 0;
      }

      .planta-card:hover {
        transform: translateY(-3px); /* Reducido el efecto */
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
      }

      /* Estilo para la planta seleccionada */
      .planta-seleccionada {
        background-color: #4a8f29;
        border: 2px solid #ffd700;
        transform: translateY(-3px);
        box-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
      }

      .planta-img {
        width: 45px; /* Aumentado el tama√±o */
        height: 45px; /* Aumentado el tama√±o */
        background-color: #5da03a;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px; /* Tama√±o aumentado */
      }

      .planta-costo {
        position: absolute;
        top: -5px;
        right: -5px;
        background-color: #333;
        color: #ffd700;
        border-radius: 50%;
        width: 18px; /* Reducido el tama√±o */
        height: 18px; /* Reducido el tama√±o */
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        border: 1px solid #ffd700;
        font-size: 10px; /* Tama√±o reducido */
      }

      #contenedor-principal {
        display: grid;
        grid-template-columns: repeat(10, 1fr); /* A√±adida una columna extra */
        grid-template-rows: repeat(5, 1fr);
        gap: 2px;
        width: 100%;
        background-color: #4a8f29; /* Verde c√©sped */
        padding: 10px;
        border: 5px solid #8b4513; /* Marr√≥n para el borde */
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        height: calc(100vh - 170px); /* Ajustado para las barras m√°s grandes */
        margin-top: 170px; /* Ajustado para las barras m√°s grandes */
        box-sizing: border-box;
        position: relative;
        overflow: hidden;
      }

      .elemento {
        width: 100%;
        height: 100%;
        background-color: #5da03a; /* Verde m√°s claro para las casillas */
        border: 1px dashed #4a8f29;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        position: relative;
        transition: all 0.2s;
      }

      .elemento:hover {
        background-color: #6ab447;
        cursor: pointer;
      }

      /* Estilo para la columna de podadoras */
      .columna-podadoras {
        background-color: #8b4513 !important; /* Color marr√≥n para diferenciar */
        border: 1px solid #6c5353 !important;
        cursor: default !important;
      }

      .columna-podadoras:hover {
        background-color: #8b4513 !important;
      }

      /* Estilo para las podadoras */
      .podadora {
        font-size: 30px;
        position: relative;
        z-index: 5;
      }

      /* Animaci√≥n para las podadoras activadas */
      @keyframes podadora-activada {
        0% {
          left: 0;
        }
        100% {
          left: 100vw;
        }
      }

      .podadora-activada {
        position: absolute;
        animation: podadora-activada 3s linear forwards;
        z-index: 15;
      }

      .opciones-plantas {
        display: flex;
        justify-content: space-around;
        margin: 10px 5px; /* Reducido el margen */
        flex-wrap: wrap;
        gap: 5px; /* Reducido el gap */
      }

      .opcion-planta {
        width: 60px; /* Reducido el tama√±o */
        height: 60px; /* Reducido el tama√±o */
        background-color: #8b4513;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px; /* Tama√±o reducido */
        border-radius: 50%;
        border: 3px solid #6c5353;
        transition: all 0.2s;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      .opcion-planta:hover {
        transform: scale(1.05); /* Reducido el efecto */
        box-shadow: 0 0 10px rgba(255, 255, 0, 0.5);
      }

      .semilla {
        animation: aparecer 0.5s forwards;
      }

      @keyframes aparecer {
        0% {
          transform: scale(0);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .recoger-semilla {
        animation: recoger 0.5s forwards;
      }

      @keyframes recoger {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.5);
          opacity: 0.7;
        }
        100% {
          transform: scale(0);
          opacity: 0;
        }
      }

      /* Estilos para el bot√≥n de pantalla completa */
      #fullscreen-btn {
        width: 30px; /* Reducido el tama√±o */
        height: 30px; /* Reducido el tama√±o */
        background-color: #8b4513;
        border: 2px solid #6c5353;
        border-radius: 50%;
        color: white;
        font-size: 16px; /* Tama√±o reducido */
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
      }

      #fullscreen-btn:hover {
        transform: scale(1.05);
        background-color: #6c5353;
      }

      /* Estilo para cuando estamos en pantalla completa */
      .fullscreen-active {
        background-color: #4a8f29 !important;
      }

      /* Cursor personalizado cuando hay una planta seleccionada */
      .cursor-planta {
        cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="14" fill="%234a8f29" stroke="%23000" stroke-width="2"/></svg>')
            16 16,
          auto;
      }

      /* Estilos para zombies */
      .zombie {
        position: absolute;
        font-size: 40px;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        animation: caminar 0.8s infinite alternate;
        z-index: 10;
      }

      @keyframes caminar {
        0% {
          transform: translateY(-50%) rotate(-5deg);
        }
        100% {
          transform: translateY(-50%) rotate(5deg);
        }
      }

      /* Estilos para proyectiles */
      .proyectil {
        position: absolute;
        font-size: 24px;
        z-index: 5;
        animation: volar 4s linear forwards; /* Aumentado a 4s para que lleguen m√°s lejos */
      }

      @keyframes volar {
        0% {
          left: 20%;
        }
        100% {
          left: 200%;
        } /* Aumentado a 200% para que lleguen m√°s lejos */
      }

      /* Estilos para indicadores de da√±o */
      .indicador-dano {
        position: absolute;
        color: #ff3333;
        font-weight: bold;
        font-size: 20px;
        z-index: 20;
        animation: flotar-dano 1s forwards;
        pointer-events: none;
      }

      @keyframes flotar-dano {
        0% {
          opacity: 1;
          transform: translateY(0);
        }
        100% {
          opacity: 0;
          transform: translateY(-30px);
        }
      }

      /* Estilos para plantas colocadas */
      .planta-colocada {
        position: relative;
        z-index: 5;
        font-size: 40px;
      }

      /* Pantalla de fin de juego */
      #pantalla-fin {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        color: white;
      }

      .mensaje-fin {
        font-size: 60px;
        margin-bottom: 30px;
        text-align: center;
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      }

      .victoria {
        color: #4a8f29;
      }

      .derrota {
        color: #ff3333;
      }

      .boton-reiniciar {
        background-color: #4a8f29;
        color: white;
        font-size: 24px;
        padding: 15px 40px;
        border-radius: 50px;
        border: 4px solid #8b4513;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 8px 0 #2d5718, 0 15px 20px rgba(0, 0, 0, 0.35);
        text-transform: uppercase;
        font-weight: bold;
      }

      .boton-reiniciar:hover {
        transform: translateY(-5px);
        box-shadow: 0 13px 0 #2d5718, 0 20px 25px rgba(0, 0, 0, 0.35);
      }

      /* Tooltip para mostrar informaci√≥n de plantas */
      .tooltip {
        position: absolute;
        background-color: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 12px;
        z-index: 1500;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s;
        max-width: 150px;
        text-align: center;
      }

      .planta-card:hover .tooltip {
        opacity: 1;
      }

      /* Bot√≥n de m√∫sica */
      #music-btn {
        width: 30px;
        height: 30px;
        background-color: #8b4513;
        border: 2px solid #6c5353;
        border-radius: 50%;
        color: white;
        font-size: 16px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
        margin-right: 10px;
      }

      #music-btn:hover {
        transform: scale(1.05);
        background-color: #6c5353;
      }

      .music-off {
        background-color: #ff3333 !important;
      }
    </style>
  </head>
  <body>
    <!-- Pantalla de inicio -->
    <div id="pantalla-inicio">
      <h1 class="titulo-inicio">Hongos vs Zombies 2</h1>
      <div class="boton-jugar" id="btn-jugar">JUGAR</div>
      <div class="botones-adicionales">
        <div class="boton-secundario">Opciones</div>
        <div class="boton-secundario">Cr√©ditos</div>
      </div>
      <div class="personajes-inicio">
        <div class="hongo-inicio">üçÑ</div>
        <div class="zombie-inicio">üßü</div>
      </div>
    </div>

    <!-- Pantalla del juego -->
    <div id="pantalla-juego">
      <!-- Barra superior fija -->
      <div class="barra-superior">
        <div class="sol-contador" id="contador-soles">50</div>
        <div class="oleada-contador" id="contador-oleadas">Oleada: 1</div>
        <div style="display: flex; align-items: center">
          <div id="music-btn" title="Activar/Desactivar m√∫sica">üéµ</div>
          <div id="fullscreen-btn" title="Pantalla completa">üì∫</div>
        </div>
      </div>

      <!-- Selector de plantas -->
      <div class="plantas-seleccion" id="selector-plantas">
        <div
          class="planta-card"
          data-costo="50"
          data-planta="üçÑ"
          data-tipo="ataque"
          data-vida="100"
          data-dano="20"
          data-descripcion="Hongo b√°sico. Da√±a zombies al contacto."
        >
          <div class="planta-costo">50</div>
          <div class="planta-img">üçÑ</div>
          <span>Hongo</span>
        </div>
        <div
          class="planta-card"
          data-costo="100"
          data-planta="üå∂Ô∏è"
          data-tipo="disparador"
          data-vida="80"
          data-dano="25"
          data-proyectil="üî•"
          data-descripcion="Chile picante. Dispara fuego a distancia."
        >
          <div class="planta-costo">100</div>
          <div class="planta-img">üå∂Ô∏è</div>
          <span>Chile</span>
        </div>
        <div
          class="planta-card"
          data-costo="125"
          data-planta="üåª"
          data-tipo="generador"
          data-vida="120"
          data-dano="0"
          data-descripcion="Genera soles cada 12 segundos."
        >
          <div class="planta-costo">125</div>
          <div class="planta-img">üåª</div>
          <span>Girasol</span>
        </div>
        <div
          class="planta-card"
          data-costo="150"
          data-planta="ü•î"
          data-tipo="defensa"
          data-vida="400"
          data-dano="0"
          data-descripcion="Barrera resistente con mucha vida."
        >
          <div class="planta-costo">150</div>
          <div class="planta-img">ü•î</div>
          <span>Papa</span>
        </div>
        <div
          class="planta-card"
          data-costo="175"
          data-planta="üå±"
          data-tipo="disparador"
          data-vida="100"
          data-dano="15"
          data-proyectil="‚ö™"
          data-velocidad="1.5"
          data-descripcion="Dispara proyectiles a mayor velocidad."
        >
          <div class="planta-costo">175</div>
          <div class="planta-img">üå±</div>
          <span>Lanzaguisantes</span>
        </div>
        <div
          class="planta-card"
          data-costo="200"
          data-planta="üßÑ"
          data-tipo="disparador"
          data-vida="90"
          data-dano="30"
          data-proyectil="üí®"
          data-descripcion="Dispara gas t√≥xico. Alto da√±o."
        >
          <div class="planta-costo">200</div>
          <div class="planta-img">üßÑ</div>
          <span>Ajo</span>
        </div>
        <div
          class="planta-card"
          data-costo="225"
          data-planta="üåµ"
          data-tipo="disparador"
          data-vida="150"
          data-dano="40"
          data-proyectil="üåµ"
          data-descripcion="Cactus poderoso. Dispara espinas."
        >
          <div class="planta-costo">225</div>
          <div class="planta-img">üåµ</div>
          <span>Cactus</span>
        </div>
      </div>

      <!-- Campo de batalla -->
      <div id="contenedor-principal"></div>

      <!-- Opciones de plantas (contenedores de semillas) -->
      <div class="opciones-plantas" id="contenedor-semillas">
        <div class="opcion-planta" data-tiene-semilla="false"></div>
        <div class="opcion-planta" data-tiene-semilla="false"></div>
        <div class="opcion-planta" data-tiene-semilla="false"></div>
        <div class="opcion-planta" data-tiene-semilla="false"></div>
        <div class="opcion-planta" data-tiene-semilla="false"></div>
        <div class="opcion-planta" data-tiene-semilla="false"></div>
        <div class="opcion-planta" data-tiene-semilla="false"></div>
      </div>
    </div>

    <!-- Pantalla de fin de juego -->
    <div id="pantalla-fin">
      <div class="mensaje-fin" id="mensaje-fin"></div>
      <div class="boton-reiniciar" id="boton-reiniciar">Reiniciar</div>
    </div>

    <!-- M√∫sica de fondo lofi -->
    <audio id="musica-lofi" loop>
      <source
        src="https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112191.mp3"
        type="audio/mp3"
      />
    </audio>

    <!-- Sonidos del juego -->
    <audio
      id="sonido-planta"
      src="https://assets.mixkit.co/active_storage/sfx/2652/2652-preview.mp3"
      preload="auto"
    ></audio>
    <audio
      id="sonido-seleccion"
      src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"
      preload="auto"
    ></audio>
    <audio
      id="sonido-zombie"
      src="https://assets.mixkit.co/active_storage/sfx/209/209-preview.mp3"
      preload="auto"
    ></audio>
    <audio
      id="sonido-podadora"
      src="https://assets.mixkit.co/active_storage/sfx/2148/2148-preview.mp3"
      preload="auto"
    ></audio>
    <audio
      id="sonido-sol"
      src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"
      preload="auto"
    ></audio>
    <audio
      id="sonido-planta-derrotada"
      src="https://assets.mixkit.co/active_storage/sfx/2030/2030-preview.mp3"
      preload="auto"
    ></audio>
    <audio
      id="sonido-zombie-derrotado"
      src="https://assets.mixkit.co/active_storage/sfx/2068/2068-preview.mp3"
      preload="auto"
    ></audio>
    <audio
      id="sonido-victoria"
      src="https://assets.mixkit.co/active_storage/sfx/1993/1993-preview.mp3"
      preload="auto"
    ></audio>
    <audio
      id="sonido-derrota"
      src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"
      preload="auto"
    ></audio>

    <script>
      // Variables globales
      let soles = 50;
      let intervaloSemillas;
      let plantaSeleccionada = null;
      let oleadaActual = 1;
      let zombiesEnJuego = [];
      let plantasEnJuego = [];
      let proyectilesEnJuego = [];
      let podadorasActivas = [true, true, true, true, true]; // Estado de las podadoras por fila
      let intervaloOleadas;
      let intervaloZombies;
      let intervaloProyectiles;
      let intervaloColisiones;
      let juegoTerminado = false;
      let musicaActivada = true; // Control de m√∫sica
      let sonidoActivado = true; // Control de sonido

      // Definici√≥n de tipos de zombies (equilibrados)
      const tiposZombies = [
        {
          tipo: "podador",
          emoji: "üßü‚Äç‚ôÇÔ∏è",
          vida: 100,
          dano: 10,
          velocidad: 0.25,
          descripcion: "Zombie con podadora",
        },
        {
          tipo: "talador",
          emoji: "üßü‚Äç‚ôÄÔ∏è",
          vida: 150,
          dano: 15,
          velocidad: 0.2,
          descripcion: "Zombie con motosierra",
        },
        {
          tipo: "mecanico",
          emoji: "üë®‚Äçüîß",
          vida: 200,
          dano: 20,
          velocidad: 0.15,
          descripcion: "Zombie con herramientas",
        },
        {
          tipo: "excavador",
          emoji: "üë∑",
          vida: 80,
          dano: 8,
          velocidad: 0.3,
          descripcion: "Zombie r√°pido pero d√©bil",
        },
        {
          tipo: "cientifico",
          emoji: "üë®‚Äçüî¨",
          vida: 120,
          dano: 25,
          velocidad: 0.22,
          descripcion: "Zombie que causa m√°s da√±o",
        },
        {
          tipo: "robotico",
          emoji: "ü§ñ",
          vida: 250,
          dano: 15,
          velocidad: 0.12,
          descripcion: "Zombie muy resistente pero lento",
        },
        {
          tipo: "cyborg",
          emoji: "üëæ",
          vida: 180,
          dano: 20,
          velocidad: 0.18,
          descripcion: "Zombie r√°pido y peligroso",
        },
      ];

      // Funci√≥n para reproducir sonidos
      function reproducirSonido(id) {
        if (sonidoActivado) {
          const sonido = document.getElementById(id);
          sonido.currentTime = 0;
          sonido.play();
        }
      }

      // Funci√≥n para controlar la m√∫sica
      function controlarMusica(accion) {
        const musica = document.getElementById("musica-lofi");

        if (accion === "iniciar" && musicaActivada) {
          musica.play();
        } else if (accion === "pausar") {
          musica.pause();
        } else if (accion === "toggle") {
          if (musicaActivada) {
            musica.play();
          } else {
            musica.pause();
          }
        }
      }

      // Funci√≥n para iniciar el juego
      function iniciarJuego() {
        const pantallaInicio = document.getElementById("pantalla-inicio");
        const pantallaJuego = document.getElementById("pantalla-juego");

        // Iniciar m√∫sica de fondo
        controlarMusica("iniciar");

        // Reiniciar variables
        soles = 50;
        oleadaActual = 1;
        zombiesEnJuego = [];
        plantasEnJuego = [];
        proyectilesEnJuego = [];
        podadorasActivas = [true, true, true, true, true]; // Reiniciar podadoras
        juegoTerminado = false;

        // Actualizar contadores
        actualizarContadorSoles();
        document.getElementById(
          "contador-oleadas"
        ).textContent = `Oleada: ${oleadaActual}`;

        // Animaci√≥n de transici√≥n
        pantallaInicio.style.opacity = "0";

        // Esperar a que termine la animaci√≥n
        setTimeout(() => {
          pantallaInicio.style.display = "none";
          pantallaJuego.style.display = "block";

          // Peque√±a pausa para asegurar que el DOM se actualice
          setTimeout(() => {
            pantallaJuego.style.opacity = "1";
            // Generar la matriz del juego
            generarMatriz();
            // Iniciar la generaci√≥n de semillas
            iniciarGeneracionSemillas();
            // Configurar el selector de plantas
            configurarSelectorPlantas();
            // Iniciar el sistema de oleadas
            iniciarSistemaOleadas();
            // Iniciar el sistema de proyectiles
            iniciarSistemaProyectiles();
            // Iniciar el sistema de colisiones
            iniciarSistemaColisiones();
          }, 50);
        }, 1000);
      }

      // Funci√≥n para configurar el selector de plantas
      function configurarSelectorPlantas() {
        const plantasCards = document.querySelectorAll(".planta-card");

        plantasCards.forEach((card) => {
          // A√±adir tooltips para mostrar informaci√≥n de las plantas
          const descripcion = card.getAttribute("data-descripcion");
          const tipo = card.getAttribute("data-tipo");
          const vida = card.getAttribute("data-vida");
          const dano = card.getAttribute("data-dano");

          const tooltip = document.createElement("div");
          tooltip.className = "tooltip";
          tooltip.innerHTML = `
          <strong>${card.querySelector("span").textContent}</strong><br>
          ${descripcion}
        `;
          card.appendChild(tooltip);

          card.addEventListener("click", function () {
            // Quitar la clase seleccionada de todas las plantas
            plantasCards.forEach((c) =>
              c.classList.remove("planta-seleccionada")
            );

            // A√±adir la clase seleccionada a esta planta
            this.classList.add("planta-seleccionada");

            // Guardar la planta seleccionada
            plantaSeleccionada = {
              emoji: this.getAttribute("data-planta"),
              costo: parseInt(this.getAttribute("data-costo")),
              tipo: this.getAttribute("data-tipo"),
              vida: parseInt(this.getAttribute("data-vida")),
              dano: parseInt(this.getAttribute("data-dano")),
              proyectil: this.getAttribute("data-proyectil") || null,
              velocidad: parseFloat(this.getAttribute("data-velocidad")) || 1.0,
            };

            // Cambiar el cursor
            document.body.classList.add("cursor-planta");
          });
        });

        // Permitir deseleccionar haciendo clic en cualquier parte fuera de las plantas
        document.addEventListener("click", function (e) {
          if (
            !e.target.closest(".planta-card") &&
            !e.target.closest(".elemento")
          ) {
            plantasCards.forEach((c) =>
              c.classList.remove("planta-seleccionada")
            );
            plantaSeleccionada = null;
            document.body.classList.remove("cursor-planta");
          }
        });
      }

      // Funci√≥n para generar la matriz
      function generarMatriz() {
        const contenedor = document.getElementById("contenedor-principal");
        contenedor.innerHTML = ""; // Limpiar el contenedor

        // Crear 50 elementos (10x5 grid) - Ahora con columna extra para podadoras
        for (let fila = 0; fila < 5; fila++) {
          for (let columna = 0; columna < 10; columna++) {
            const elemento = document.createElement("div");
            elemento.className = "elemento";
            elemento.id = `elemento-${fila}-${columna}`;
            elemento.setAttribute("data-fila", fila);
            elemento.setAttribute("data-columna", columna);

            // Si es la primera columna, es para podadoras
            if (columna === 0) {
              elemento.className = "elemento columna-podadoras";

              // A√±adir podadora si est√° activa en esta fila
              if (podadorasActivas[fila]) {
                const podadora = document.createElement("div");
                podadora.className = "podadora";
                podadora.textContent = "üöú"; // Emoji de tractor para la podadora
                podadora.setAttribute("data-fila", fila);
                elemento.appendChild(podadora);
              }
            } else {
              // A√±adir c√©sped con variaci√≥n para las dem√°s columnas
              const randomGrass = Math.floor(Math.random() * 3);
              if (randomGrass === 0) {
                elemento.innerHTML =
                  '<span style="color: #4a8f29; font-size: 20px;"> ∑</span>';
              } else if (randomGrass === 1) {
                elemento.innerHTML =
                  '<span style="color: #4a8f29; font-size: 20px;"> ¨</span>';
              }

              // Hacer que las casillas sean interactivas (excepto la columna de podadoras)
              elemento.addEventListener("click", function () {
                // Verificar si hay una planta seleccionada
                if (plantaSeleccionada) {
                  // Verificar si ya hay una planta en esta casilla
                  if (!this.querySelector(".planta-colocada")) {
                    // Verificar si tenemos suficientes soles
                    if (soles >= plantaSeleccionada.costo) {
                      // Colocar la planta
                      const planta = document.createElement("div");
                      planta.className = "planta-colocada";
                      planta.textContent = plantaSeleccionada.emoji;

                      // A√±adir atributos para el sistema de vida
                      planta.setAttribute("data-vida", plantaSeleccionada.vida);
                      planta.setAttribute(
                        "data-vida-max",
                        plantaSeleccionada.vida
                      );
                      planta.setAttribute("data-dano", plantaSeleccionada.dano);
                      planta.setAttribute("data-tipo", plantaSeleccionada.tipo);
                      if (plantaSeleccionada.proyectil) {
                        planta.setAttribute(
                          "data-proyectil",
                          plantaSeleccionada.proyectil
                        );
                        planta.setAttribute("data-ultimo-disparo", Date.now());
                        if (plantaSeleccionada.velocidad) {
                          planta.setAttribute(
                            "data-velocidad",
                            plantaSeleccionada.velocidad
                          );
                        }
                      }

                      // Guardar el contenido actual para preservar zombies
                      const contenidoActual = this.innerHTML;

                      // Limpiar el contenido de c√©sped pero preservar zombies
                      this.innerHTML = "";

                      // A√±adir la planta
                      this.appendChild(planta);

                      // Restar el costo
                      soles -= plantaSeleccionada.costo;
                      actualizarContadorSoles();

                      // Efecto visual de colocaci√≥n exitosa
                      planta.style.animation = "aparecer 0.3s forwards";

                      // A√±adir la planta al registro
                      plantasEnJuego.push({
                        elemento: planta,
                        fila: parseInt(this.getAttribute("data-fila")),
                        columna: parseInt(this.getAttribute("data-columna")),
                        tipo: plantaSeleccionada.tipo,
                        vida: plantaSeleccionada.vida,
                        vidaMax: plantaSeleccionada.vida,
                        dano: plantaSeleccionada.dano,
                        proyectil: plantaSeleccionada.proyectil,
                        velocidad: plantaSeleccionada.velocidad || 1.0,
                        ultimoDisparo: plantaSeleccionada.proyectil
                          ? Date.now()
                          : null,
                      });

                      // Si es un girasol, iniciar generaci√≥n de soles
                      if (plantaSeleccionada.tipo === "generador") {
                        iniciarGeneracionSolesGirasol(planta);
                      }
                    } else {
                      // Efecto visual de "no hay suficientes soles"
                      const contador =
                        document.getElementById("contador-soles");
                      contador.style.backgroundColor = "#ff3333";
                      setTimeout(() => {
                        contador.style.backgroundColor = "#333";
                      }, 300);
                    }
                  }
                }
              });
            }

            contenedor.appendChild(elemento);
          }
        }
      }

      // Funci√≥n para activar la podadora en una fila
      function activarPodadora(fila) {
        // Verificar si la podadora est√° activa
        if (!podadorasActivas[fila]) return;

        // Marcar la podadora como usada
        podadorasActivas[fila] = false;

        // Obtener el elemento de la podadora
        const elementoPodadora = document.getElementById(`elemento-${fila}-0`);
        const podadora = elementoPodadora.querySelector(".podadora");

        if (podadora) {
          // Crear una podadora animada
          const podadoraAnimada = document.createElement("div");
          podadoraAnimada.className = "podadora podadora-activada";
          podadoraAnimada.textContent = "üöú";
          podadoraAnimada.style.top = "50%";
          podadoraAnimada.style.transform = "translateY(-50%)";

          // Eliminar la podadora est√°tica
          elementoPodadora.removeChild(podadora);

          // A√±adir la podadora animada al contenedor principal
          document
            .getElementById("contenedor-principal")
            .appendChild(podadoraAnimada);

          // Eliminar todos los zombies en esta fila
          for (let i = zombiesEnJuego.length - 1; i >= 0; i--) {
            const zombie = zombiesEnJuego[i];
            if (zombie.fila === fila) {
              // Eliminar el zombie del DOM
              if (zombie.elemento.parentNode) {
                zombie.elemento.parentNode.removeChild(zombie.elemento);
              }
              // Eliminar el zombie del registro
              zombiesEnJuego.splice(i, 1);
            }
          }

          // Eliminar la podadora animada despu√©s de la animaci√≥n
          setTimeout(() => {
            if (podadoraAnimada.parentNode) {
              podadoraAnimada.parentNode.removeChild(podadoraAnimada);
            }
          }, 3000);
        }
      }

      // Funci√≥n para iniciar la generaci√≥n de soles de girasol
      function iniciarGeneracionSolesGirasol(girasol) {
        setInterval(() => {
          // Verificar si el girasol sigue vivo
          if (
            girasol.parentNode &&
            parseInt(girasol.getAttribute("data-vida")) > 0
          ) {
            // Generar un sol
            const sol = document.createElement("div");
            sol.className = "semilla";
            sol.textContent = "‚òÄÔ∏è";
            sol.style.position = "absolute";
            sol.style.top = "0";
            sol.style.left = "50%";
            sol.style.transform = "translateX(-50%)";
            sol.style.zIndex = "15";
            sol.style.cursor = "pointer";

            // A√±adir evento para recoger el sol
            sol.addEventListener("click", function () {
              if (this.parentNode) {
                this.classList.add("recoger-semilla");

                // Sumar soles (entre 15 y 25)
                const solesSumados = Math.floor(Math.random() * 11) + 15;
                soles += solesSumados;
                actualizarContadorSoles();

                // Mostrar animaci√≥n de +X soles
                mostrarIndicadorSoles(this, solesSumados);

                // Eliminar el sol despu√©s de la animaci√≥n
                setTimeout(() => {
                  if (this.parentNode) {
                    this.parentNode.removeChild(this);
                  }
                }, 500);
              }
            });

            girasol.parentNode.appendChild(sol);
          }
        }, 12000); // Generaci√≥n m√°s r√°pida: cada 12 segundos
      }

      // Funci√≥n para mostrar indicador de soles
      function mostrarIndicadorSoles(elemento, cantidad) {
        const indicadorSoles = document.createElement("div");
        indicadorSoles.textContent = "+" + cantidad;
        indicadorSoles.style.position = "absolute";
        indicadorSoles.style.color = "#FFD700";
        indicadorSoles.style.fontWeight = "bold";
        indicadorSoles.style.fontSize = "20px";
        indicadorSoles.style.top = "0";
        indicadorSoles.style.left = "50%";
        indicadorSoles.style.transform = "translateX(-50%)";
        indicadorSoles.style.textShadow = "1px 1px 2px black";
        indicadorSoles.style.pointerEvents = "none";
        indicadorSoles.style.animation = "flotar-dano 1.5s forwards";
        indicadorSoles.style.zIndex = "20";
        elemento.parentNode.appendChild(indicadorSoles);

        // Eliminar el indicador despu√©s de la animaci√≥n
        setTimeout(() => {
          if (indicadorSoles.parentNode) {
            indicadorSoles.parentNode.removeChild(indicadorSoles);
          }
        }, 1500);
      }

      // Funci√≥n para iniciar la generaci√≥n de semillas
      function iniciarGeneracionSemillas() {
        // Configurar los eventos de clic para las opciones de plantas
        const opcionesPlantas = document.querySelectorAll(".opcion-planta");
        opcionesPlantas.forEach((opcion) => {
          opcion.addEventListener("click", recogerSemilla);
        });

        // Iniciar el intervalo para generar semillas
        intervaloSemillas = setInterval(generarSemilla, 2500); // M√°s r√°pido: cada 2.5 segundos
      }

      // Funci√≥n para generar una semilla en un contenedor aleatorio
      function generarSemilla() {
        const contenedores = document.querySelectorAll(".opcion-planta");
        const contenedoresVacios = Array.from(contenedores).filter(
          (contenedor) =>
            contenedor.getAttribute("data-tiene-semilla") === "false"
        );

        // Si no hay contenedores vac√≠os, no hacer nada
        if (contenedoresVacios.length === 0) return;

        // Seleccionar un contenedor aleatorio
        const indiceAleatorio = Math.floor(
          Math.random() * contenedoresVacios.length
        );
        const contenedorElegido = contenedoresVacios[indiceAleatorio];

        // A√±adir la semilla
        contenedorElegido.innerHTML = '<div class="semilla">‚òÄÔ∏è</div>';
        contenedorElegido.setAttribute("data-tiene-semilla", "true");
      }

      // Funci√≥n para recoger una semilla
      function recogerSemilla() {
        // Verificar si este contenedor tiene una semilla
        if (this.getAttribute("data-tiene-semilla") === "true") {
          // A√±adir clase para la animaci√≥n de recoger
          const semilla = this.querySelector(".semilla");
          semilla.classList.add("recoger-semilla");

          // Marcar como recogida
          this.setAttribute("data-tiene-semilla", "false");

          // Sumar soles (entre 15 y 25)
          const solesSumados = Math.floor(Math.random() * 11) + 15;
          soles += solesSumados;
          actualizarContadorSoles();

          // Mostrar animaci√≥n de +X soles
          mostrarIndicadorSoles(this, solesSumados);

          // Eliminar la semilla despu√©s de la animaci√≥n
          setTimeout(() => {
            this.innerHTML = "";
          }, 500);
        }
      }

      // Funci√≥n para actualizar el contador de soles
      function actualizarContadorSoles() {
        const contador = document.getElementById("contador-soles");
        contador.textContent = soles;
      }

      // Funci√≥n para iniciar el sistema de oleadas
      function iniciarSistemaOleadas() {
        // Iniciar la primera oleada
        generarOleada();

        // Configurar intervalo para nuevas oleadas
        intervaloOleadas = setInterval(() => {
          oleadaActual++;
          document.getElementById(
            "contador-oleadas"
          ).textContent = `Oleada: ${oleadaActual}`;

          // Verificar si hemos llegado a la oleada 10 (victoria)
          if (oleadaActual > 10) {
            mostrarFinJuego(true);
            return;
          }

          generarOleada();
        }, 60000 - oleadaActual * 2000); // Reducir tiempo entre oleadas a medida que avanza el juego
      }

      // Funci√≥n para generar una oleada de zombies
      function generarOleada() {
        // Calcular n√∫mero de zombies basado en la oleada actual (aumenta con cada oleada)
        const numZombies = Math.min(3 + oleadaActual * 2, 25);

        // Calcular intervalo entre zombies (m√°s r√°pido en oleadas avanzadas)
        const intervaloBase = Math.max(6000 - oleadaActual * 400, 1500);

        // Limpiar intervalo anterior si existe
        if (intervaloZombies) {
          clearInterval(intervaloZombies);
        }

        // Contador para zombies generados
        let zombiesGenerados = 0;

        // Generar zombies con intervalo
        intervaloZombies = setInterval(() => {
          if (zombiesGenerados < numZombies) {
            generarZombie();
            zombiesGenerados++;
          } else {
            clearInterval(intervaloZombies);
          }
        }, intervaloBase);
      }

      // Funci√≥n para generar un zombie
      function generarZombie() {
        if (juegoTerminado) return;

        // Seleccionar una fila aleatoria (0-4)
        const fila = Math.floor(Math.random() * 5);

        // Seleccionar un tipo de zombie aleatorio
        // En oleadas avanzadas, mayor probabilidad de zombies fuertes
        let tipoZombie;
        if (oleadaActual >= 8) {
          // Oleadas finales: m√°s probabilidad de zombies fuertes
          const indiceAleatorio = Math.floor(
            Math.random() * tiposZombies.length
          );
          tipoZombie =
            tiposZombies[
              Math.min(indiceAleatorio + 2, tiposZombies.length - 1)
            ];

          // Aumentar vida y velocidad en oleadas finales
          tipoZombie = { ...tipoZombie };
          tipoZombie.vida = Math.floor(
            tipoZombie.vida * (1 + oleadaActual * 0.1)
          );
          tipoZombie.velocidad =
            tipoZombie.velocidad * (1 + oleadaActual * 0.05);
        } else if (oleadaActual >= 5) {
          // Oleadas medias: zombies variados
          tipoZombie = {
            ...tiposZombies[Math.floor(Math.random() * tiposZombies.length)],
          };
          tipoZombie.vida = Math.floor(
            tipoZombie.vida * (1 + oleadaActual * 0.05)
          );
        } else {
          // Oleadas iniciales: zombies m√°s d√©biles
          const indiceAleatorio = Math.floor(
            Math.random() * tiposZombies.length
          );
          tipoZombie = { ...tiposZombies[Math.min(indiceAleatorio, 3)] };
        }

        // Crear el elemento zombie
        const zombie = document.createElement("div");
        zombie.className = "zombie";
        zombie.textContent = tipoZombie.emoji;
        zombie.style.right = "0";

        // A√±adir atributos para el sistema de vida
        zombie.setAttribute("data-tipo", tipoZombie.tipo);
        zombie.setAttribute("data-vida", tipoZombie.vida);
        zombie.setAttribute("data-vida-max", tipoZombie.vida);
        zombie.setAttribute("data-dano", tipoZombie.dano);
        zombie.setAttribute("data-velocidad", tipoZombie.velocidad);

        // Encontrar el elemento de la fila y √∫ltima columna
        const elemento = document.getElementById(`elemento-${fila}-9`); // Ahora la √∫ltima columna es la 9
        elemento.appendChild(zombie);

        // A√±adir el zombie al registro
        zombiesEnJuego.push({
          elemento: zombie,
          fila: fila,
          columna: 9, // Ahora la √∫ltima columna es la 9
          tipo: tipoZombie.tipo,
          vida: tipoZombie.vida,
          vidaMax: tipoZombie.vida,
          dano: tipoZombie.dano,
          velocidad: tipoZombie.velocidad,
          ultimoMovimiento: Date.now(),
        });
      }

      // Funci√≥n para mover zombies
      function moverZombies() {
        if (juegoTerminado) return;

        const ahora = Date.now();

        // Recorrer todos los zombies en juego
        for (let i = zombiesEnJuego.length - 1; i >= 0; i--) {
          const zombie = zombiesEnJuego[i];

          // Verificar si el zombie sigue vivo
          if (!zombie.elemento.parentNode || zombie.vida <= 0) {
            // Eliminar zombie del registro
            zombiesEnJuego.splice(i, 1);
            continue;
          }

          // Calcular si es momento de mover el zombie
          const tiempoDesdeUltimoMovimiento = ahora - zombie.ultimoMovimiento;
          const intervaloMovimiento = 1000 / zombie.velocidad;

          if (tiempoDesdeUltimoMovimiento >= intervaloMovimiento) {
            // Actualizar tiempo de √∫ltimo movimiento
            zombie.ultimoMovimiento = ahora;

            // Si el zombie est√° en la columna 1 (justo antes de las podadoras), activar podadora
            if (zombie.columna === 1) {
              activarPodadora(zombie.fila);
              continue;
            }

            // Si el zombie est√° en la columna 0, ha llegado al final (derrota)
            if (zombie.columna <= 0) {
              mostrarFinJuego(false);
              return;
            }

            // Mover el zombie a la siguiente columna
            const nuevaColumna = zombie.columna - 1;
            const nuevoElemento = document.getElementById(
              `elemento-${zombie.fila}-${nuevaColumna}`
            );

            // Verificar si hay una planta en la nueva posici√≥n
            const plantaEnPosicion =
              nuevoElemento.querySelector(".planta-colocada");

            if (plantaEnPosicion) {
              // El zombie ataca a la planta
              const vidaPlanta = parseInt(
                plantaEnPosicion.getAttribute("data-vida")
              );
              const danoZombie = parseInt(
                zombie.elemento.getAttribute("data-dano")
              );

              // Aplicar da√±o a la planta
              const nuevaVida = Math.max(0, vidaPlanta - danoZombie);
              plantaEnPosicion.setAttribute("data-vida", nuevaVida);

              // Mostrar indicador de da√±o
              mostrarIndicadorDano(plantaEnPosicion, danoZombie);

              // Actualizar apariencia de la planta seg√∫n su vida
              actualizarAparienciaSegunVida(
                plantaEnPosicion,
                nuevaVida,
                parseInt(plantaEnPosicion.getAttribute("data-vida-max"))
              );

              // Si la planta es de tipo ataque, tambi√©n da√±a al zombie
              if (plantaEnPosicion.getAttribute("data-tipo") === "ataque") {
                const danoPlanta = parseInt(
                  plantaEnPosicion.getAttribute("data-dano")
                );
                zombie.vida -= danoPlanta;
                zombie.elemento.setAttribute("data-vida", zombie.vida);

                // Mostrar indicador de da√±o en el zombie
                mostrarIndicadorDano(zombie.elemento, danoPlanta);

                // Actualizar apariencia del zombie seg√∫n su vida
                actualizarAparienciaSegunVida(
                  zombie.elemento,
                  zombie.vida,
                  zombie.vidaMax
                );

                // Si el zombie muere, eliminarlo
                if (zombie.vida <= 0) {
                  if (zombie.elemento.parentNode) {
                    zombie.elemento.parentNode.removeChild(zombie.elemento);
                    zombiesEnJuego.splice(i, 1);
                  }
                  continue;
                }
              }

              // Si la planta muere, el zombie avanza
              if (nuevaVida <= 0) {
                // Eliminar la planta
                nuevoElemento.removeChild(plantaEnPosicion);

                // Eliminar la planta del registro
                for (let j = plantasEnJuego.length - 1; j >= 0; j--) {
                  if (plantasEnJuego[j].elemento === plantaEnPosicion) {
                    plantasEnJuego.splice(j, 1);
                    break;
                  }
                }

                // Mover el zombie
                if (zombie.elemento.parentNode) {
                  zombie.elemento.parentNode.removeChild(zombie.elemento);
                  nuevoElemento.appendChild(zombie.elemento);
                  zombie.columna = nuevaColumna;
                }
              }
            } else {
              // No hay planta, el zombie avanza
              if (zombie.elemento.parentNode) {
                zombie.elemento.parentNode.removeChild(zombie.elemento);
                nuevoElemento.appendChild(zombie.elemento);
                zombie.columna = nuevaColumna;
              }
            }
          }
        }
      }

      // Funci√≥n para iniciar el sistema de proyectiles
      function iniciarSistemaProyectiles() {
        // Configurar intervalo para disparar proyectiles
        intervaloProyectiles = setInterval(() => {
          if (juegoTerminado) return;

          // Recorrer todas las plantas que disparan
          for (let i = 0; i < plantasEnJuego.length; i++) {
            const planta = plantasEnJuego[i];

            // Verificar si es una planta que dispara y si est√° viva
            if (
              planta.tipo === "disparador" &&
              planta.elemento.parentNode &&
              parseInt(planta.elemento.getAttribute("data-vida")) > 0
            ) {
              // Verificar si hay zombies en la misma fila
              const zombiesEnFila = zombiesEnJuego.filter(
                (zombie) => zombie.fila === planta.fila
              );

              if (zombiesEnFila.length > 0) {
                // Verificar si ha pasado suficiente tiempo desde el √∫ltimo disparo
                const ahora = Date.now();
                const tiempoDesdeUltimoDisparo = ahora - planta.ultimoDisparo;
                const intervaloDisparo = planta.velocidad
                  ? 3000 / planta.velocidad
                  : 3000;

                if (tiempoDesdeUltimoDisparo >= intervaloDisparo) {
                  // Actualizar tiempo de √∫ltimo disparo
                  planta.ultimoDisparo = ahora;
                  planta.elemento.setAttribute("data-ultimo-disparo", ahora);

                  // Crear proyectil
                  const proyectil = document.createElement("div");
                  proyectil.className = "proyectil";
                  proyectil.textContent = planta.proyectil;
                  proyectil.style.top = "50%";
                  proyectil.style.transform = "translateY(-50%)";

                  // A√±adir atributos para el sistema de da√±o
                  proyectil.setAttribute("data-dano", planta.dano);
                  proyectil.setAttribute("data-fila", planta.fila);

                  // A√±adir el proyectil al elemento de la planta
                  planta.elemento.parentNode.appendChild(proyectil);

                  // A√±adir el proyectil al registro
                  proyectilesEnJuego.push({
                    elemento: proyectil,
                    fila: planta.fila,
                    columna: planta.columna,
                    dano: planta.dano,
                    creacion: ahora,
                  });
                }
              }
            }
          }

          // Mover proyectiles existentes
          moverProyectiles();
        }, 100); // Actualizar cada 100ms
      }

      // Funci√≥n para mover proyectiles
      function moverProyectiles() {
        const ahora = Date.now();

        // Recorrer todos los proyectiles en juego
        for (let i = proyectilesEnJuego.length - 1; i >= 0; i--) {
          const proyectil = proyectilesEnJuego[i];

          // Verificar si el proyectil sigue en el juego
          if (!proyectil.elemento.parentNode) {
            proyectilesEnJuego.splice(i, 1);
            continue;
          }

          // Si el proyectil ha estado en juego por m√°s de 4 segundos, eliminarlo
          if (ahora - proyectil.creacion > 4000) {
            proyectil.elemento.parentNode.removeChild(proyectil.elemento);
            proyectilesEnJuego.splice(i, 1);
            continue;
          }
        }
      }

      // Funci√≥n para iniciar el sistema de colisiones
      function iniciarSistemaColisiones() {
        intervaloColisiones = setInterval(() => {
          if (juegoTerminado) return;

          // Verificar colisiones entre proyectiles y zombies
          for (let i = proyectilesEnJuego.length - 1; i >= 0; i--) {
            const proyectil = proyectilesEnJuego[i];

            // Verificar si el proyectil sigue en el juego
            if (!proyectil.elemento.parentNode) {
              proyectilesEnJuego.splice(i, 1);
              continue;
            }

            // Buscar zombies en la misma fila
            for (let j = zombiesEnJuego.length - 1; j >= 0; j--) {
              const zombie = zombiesEnJuego[j];

              // Verificar si el zombie sigue en el juego
              if (!zombie.elemento.parentNode) {
                zombiesEnJuego.splice(j, 1);
                continue;
              }
              {
                zombiesEnJuego.splice(j, 1);
                continue;
              }

              // Verificar si est√°n en la misma fila
              if (
                zombie.fila ===
                parseInt(proyectil.elemento.getAttribute("data-fila"))
              ) {
                // Obtener posiciones
                const rectProyectil =
                  proyectil.elemento.getBoundingClientRect();
                const rectZombie = zombie.elemento.getBoundingClientRect();

                // Verificar colisi√≥n
                if (
                  rectProyectil.right >= rectZombie.left &&
                  rectProyectil.left <= rectZombie.right
                ) {
                  // Aplicar da√±o al zombie
                  const danoProyectil = parseInt(
                    proyectil.elemento.getAttribute("data-dano")
                  );
                  zombie.vida -= danoProyectil;
                  zombie.elemento.setAttribute("data-vida", zombie.vida);

                  // Mostrar indicador de da√±o
                  mostrarIndicadorDano(zombie.elemento, danoProyectil);

                  // Actualizar apariencia del zombie seg√∫n su vida
                  actualizarAparienciaSegunVida(
                    zombie.elemento,
                    zombie.vida,
                    zombie.vidaMax
                  );

                  // Eliminar el proyectil (solo golpea a un enemigo)
                  if (proyectil.elemento.parentNode) {
                    proyectil.elemento.parentNode.removeChild(
                      proyectil.elemento
                    );
                    proyectilesEnJuego.splice(i, 1);
                  }

                  // Si el zombie muere, eliminarlo
                  if (zombie.vida <= 0) {
                    if (zombie.elemento.parentNode) {
                      zombie.elemento.parentNode.removeChild(zombie.elemento);
                      zombiesEnJuego.splice(j, 1);
                    }
                  }

                  break; // Salir del bucle de zombies para este proyectil
                }
              }
            }
          }

          // Mover zombies
          moverZombies();
        }, 100); // Verificar colisiones cada 100ms
      }

      // Funci√≥n para mostrar indicador de da√±o
      function mostrarIndicadorDano(elemento, cantidad) {
        const indicadorDano = document.createElement("div");
        indicadorDano.className = "indicador-dano";
        indicadorDano.textContent = "-" + cantidad;
        indicadorDano.style.left = Math.random() * 80 + 10 + "%";
        indicadorDano.style.top = Math.random() * 80 + 10 + "%";

        elemento.parentNode.appendChild(indicadorDano);

        // Eliminar el indicador despu√©s de la animaci√≥n
        setTimeout(() => {
          if (indicadorDano.parentNode) {
            indicadorDano.parentNode.removeChild(indicadorDano);
          }
        }, 1000);
      }

      // Funci√≥n para actualizar la apariencia seg√∫n la vida
      function actualizarAparienciaSegunVida(elemento, vida, vidaMax) {
        // Calcular porcentaje de vida
        const porcentajeVida = vida / vidaMax;

        // Ajustar opacidad seg√∫n el porcentaje de vida
        if (porcentajeVida <= 0.25) {
          elemento.style.opacity = "0.4"; // Muy d√©bil
        } else if (porcentajeVida <= 0.5) {
          elemento.style.opacity = "0.6"; // D√©bil
        } else if (porcentajeVida <= 0.75) {
          elemento.style.opacity = "0.8"; // Algo da√±ado
        } else {
          elemento.style.opacity = "1"; // Saludable
        }
      }

      // Funci√≥n para mostrar pantalla de fin de juego
      function mostrarFinJuego(esVictoria) {
        // Marcar el juego como terminado
        juegoTerminado = true;

        // Detener todos los intervalos
        clearInterval(intervaloSemillas);
        clearInterval(intervaloOleadas);
        clearInterval(intervaloZombies);
        clearInterval(intervaloProyectiles);
        clearInterval(intervaloColisiones);

        // Configurar mensaje seg√∫n resultado
        const mensajeFin = document.getElementById("mensaje-fin");
        if (esVictoria) {
          mensajeFin.textContent = "¬°VICTORIA!";
          mensajeFin.className = "mensaje-fin victoria";
        } else {
          mensajeFin.textContent = "¬°DERROTA!";
          mensajeFin.className = "mensaje-fin derrota";
        }

        // Mostrar pantalla de fin
        const pantallaFin = document.getElementById("pantalla-fin");
        pantallaFin.style.display = "flex";

        // Configurar bot√≥n de reinicio
        const botonReiniciar = document.getElementById("boton-reiniciar");
        botonReiniciar.addEventListener("click", function () {
          // Ocultar pantalla de fin
          pantallaFin.style.display = "none";
          // Reiniciar juego
          iniciarJuego();
        });
      }

      // Funci√≥n para alternar pantalla completa
      function toggleFullScreen() {
        const fullscreenBtn = document.getElementById("fullscreen-btn");

        if (
          !document.fullscreenElement &&
          !document.mozFullScreenElement &&
          !document.webkitFullscreenElement &&
          !document.msFullscreenElement
        ) {
          // Entrar en pantalla completa
          if (document.documentElement.requestFullscreen) {
            document.documentElement.requestFullscreen();
          } else if (document.documentElement.msRequestFullscreen) {
            document.documentElement.msRequestFullscreen();
          } else if (document.documentElement.mozRequestFullScreen) {
            document.documentElement.mozRequestFullScreen();
          } else if (document.documentElement.webkitRequestFullscreen) {
            document.documentElement.webkitRequestFullscreen(
              Element.ALLOW_KEYBOARD_INPUT
            );
          }
          fullscreenBtn.textContent = "‚ùå";
          fullscreenBtn.classList.add("fullscreen-active");
          fullscreenBtn.title = "Salir de pantalla completa";
        } else {
          // Salir de pantalla completa
          if (document.exitFullscreen) {
            document.exitFullscreen();
          } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
          } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
          } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
          }
          fullscreenBtn.textContent = "üì∫";
          fullscreenBtn.classList.remove("fullscreen-active");
          fullscreenBtn.title = "Pantalla completa";
        }
      }

      // Funci√≥n para alternar m√∫sica
      function toggleMusic() {
        const musicBtn = document.getElementById("music-btn");
        musicaActivada = !musicaActivada;

        if (musicaActivada) {
          musicBtn.textContent = "üéµ";
          musicBtn.classList.remove("music-off");
          musicBtn.title = "Desactivar m√∫sica";
          controlarMusica("iniciar");
        } else {
          musicBtn.textContent = "üîá";
          musicBtn.classList.add("music-off");
          musicBtn.title = "Activar m√∫sica";
          controlarMusica("pausar");
        }
      }

      // Evento para detectar cambios en el estado de pantalla completa
      document.addEventListener("fullscreenchange", updateFullscreenButton);
      document.addEventListener(
        "webkitfullscreenchange",
        updateFullscreenButton
      );
      document.addEventListener("mozfullscreenchange", updateFullscreenButton);
      document.addEventListener("MSFullscreenChange", updateFullscreenButton);

      function updateFullscreenButton() {
        const fullscreenBtn = document.getElementById("fullscreen-btn");
        if (
          document.fullscreenElement ||
          document.webkitFullscreenElement ||
          document.mozFullScreenElement ||
          document.msFullscreenElement
        ) {
          fullscreenBtn.textContent = "‚ùå";
          fullscreenBtn.classList.add("fullscreen-active");
          fullscreenBtn.title = "Salir de pantalla completa";
        } else {
          fullscreenBtn.textContent = "üì∫";
          fullscreenBtn.classList.remove("fullscreen-active");
          fullscreenBtn.title = "Pantalla completa";
        }
      }

      // Configurar eventos cuando se cargue la p√°gina
      window.onload = function () {
        // A√±adir evento al bot√≥n de jugar
        const btnJugar = document.getElementById("btn-jugar");
        btnJugar.addEventListener("click", iniciarJuego);

        // A√±adir evento al bot√≥n de pantalla completa
        const fullscreenBtn = document.getElementById("fullscreen-btn");
        fullscreenBtn.addEventListener("click", toggleFullScreen);

        // A√±adir evento al bot√≥n de m√∫sica
        const musicBtn = document.getElementById("music-btn");
        musicBtn.addEventListener("click", toggleMusic);
      };
    </script>
  </body>
</html>
